<!DOCTYPE html>
<html>
  <head>
    <title>Guestbook</title>
    <link rel="stylesheet" href="/static/styles/styles.css">
  </head>
  <body class="azeret-text">
    <h1>Guestbook</h1>

    <div>
    <h2>Leave a message</h2>
    <form action="/add" method="POST" id="message-form">
      <input type="hidden" name="id_entry" id="entry-id" value="">
      <input type="text" name="author" placeholder="Username" required>
      <input type="text" name="body" placeholder="Message" required>
      <button type="submit">Submit</button>
    </form>
    <span id="replyto"> </span>
    </div>
    <hr>

    {% for entry in datas %}
    <div>
      <strong>{{ entry[1] }}</strong>: {{ entry[2] }}
      <small>({{ entry[3] }})</small>


      <button onclick="respond({{ entry[0] }}, '{{ entry[1] }}')" id="res-{{ entry[0] }}"> Reply </button>

      {% if entry[4] > 0 %}


      <button onclick="toggleReplies({{ entry[0] }}, {{ entry[4] }})" id="btn-{{ entry[0] }}">


        Show {{ entry[4] }} replies
      </button>

      {% endif %}

      <div id="replies-{{ entry[0] }}" style="display: none;">
        {% for response in all_responses %}
        {% if response[1] == entry[0] %}
        <div style="margin-left: 20px;">
          <p><strong>{{ entry[1] }}</strong>: {{ response[2] }}</p>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endfor %}

    <script>
      function toggleReplies(entryId, replies) {
        var repliesDiv = document.getElementById('replies-' + entryId);
        var button = document.getElementById('btn-' + entryId);

        if (repliesDiv.style.display === 'none') {
          repliesDiv.style.display = 'block';
          button.textContent = 'Hide replies';
        } else {
          repliesDiv.style.display = 'none';
          button.textContent = 'Show ' + replies + ' replies';
        }
      }
    </script>
    <script>
      function respond(entryId, person){
        var form = document.getElementById('message-form')
        var entryIdInput = document.getElementById('entry-id')
        var formTitle = document.getElementById('form-title')
        var replyTo = document.getElementById('replyto')

        replyTo.textContent = "replying " + person

        form.action = '/addResponse';
        entryIdInput.value = entryId;
        formTitle.textContent = 'Reply to ' + person;
        replyTo.textContent = 'Replying to ' + person;


        console.log(entryId)
      }
    </script>
  </body>
</html>
